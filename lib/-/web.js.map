{"version":3,"sources":["-","../../../../mam.ts","../../../../my/lom/dom/context/context.ts","../../../../my/lom/dom/context/context.web.ts","../../../../mol/dom/context/context.ts","../../../../mol/dom/context/context.web.ts","../../../../mol/dom/dom.ts","../../../../mol/dom/render/children/children.ts","../../../../my/lom/view/view.ts","../../../../my/lom/view/view.web.ts","../../../../my/lom/button/button.ts","../../../../my/lom/input/input.ts","../../../../my/lom/storage/storage.ts","../../../../my/lom/theme/theme.ts"],"names":[],"mappings":"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","sourcesContent":[null,"Error.stackTraceLimit = 50;\n\ndeclare let _$_: { new(): {} } & typeof globalThis\ndeclare class $ extends _$_ {}\n\nnamespace $ {\n\texport type $ = typeof $$\n\texport declare class $$ extends $ {}\n\tnamespace $$ {\n\t\texport type $$ = $\n\t}\n}\n\nmodule.exports = $\n","// mam/my/lom/dom/context/context.ts\nlet $my_lom_dom_context: typeof globalThis\n","// mam/my/lom/dom/context/context.web.ts\n$my_lom_dom_context = self\n","namespace $ {\n\t\n\texport var $mol_dom_context : typeof globalThis\n\t\n}\n","namespace $ {\n\t\n\t$.$mol_dom_context = self as any\n\t\n}\n","namespace $ {\n\t\n\texport var $mol_dom = $mol_dom_context\n\t\n}\n","namespace $ {\n\n\texport function $mol_dom_render_children (\n\t\tel : Element | DocumentFragment ,\n\t\tchildNodes : NodeList | Array< Node | string | null >\n\t) {\n\t\tconst node_set = new Set< Node | string | null >( childNodes )\n\t\t\n\t\tlet nextNode : Node | null = el.firstChild\n\t\tfor( let view of childNodes ) {\n\n\t\t\tif( view == null ) continue\n\n\t\t\tif( view instanceof $mol_dom_context.Node ) {\n\t\t\t\t\n\t\t\t\twhile( true ) {\n\t\t\t\t\tif( !nextNode ) {\n\t\t\t\t\t\tel.appendChild( view )\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tif( nextNode == view ) {\n\t\t\t\t\t\tnextNode = nextNode.nextSibling\n\t\t\t\t\t\tbreak\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif( node_set.has( nextNode ) ) {\n\t\t\t\t\t\t\tel.insertBefore( view , nextNode )\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst nn = nextNode.nextSibling\n\t\t\t\t\t\t\tel.removeChild( nextNode )\n\t\t\t\t\t\t\tnextNode = nn\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tif( nextNode && nextNode.nodeName === '#text' ) {\n\t\t\t\t\tconst str = String( view )\n\t\t\t\t\tif( nextNode.nodeValue !== str ) nextNode.nodeValue = str\n\t\t\t\t\tnextNode = nextNode.nextSibling\n\t\t\t\t} else {\n\t\t\t\t\tconst textNode = $mol_dom_context.document.createTextNode( String( view ) )\n\t\t\t\t\tel.insertBefore( textNode , nextNode )\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\twhile( nextNode ) {\n\t\t\tconst currNode = nextNode\n\t\t\tnextNode = currNode.nextSibling\n\t\t\tel.removeChild( currNode )\n\t\t}\n\t}\n\n}\n","class $my_lom_view {\n\tstatic root: ()=> typeof $my_lom_view\n\n\tstatic mount() {\n\t\tconst node = $my_lom_dom_context.document.querySelector( '#root' )\n\t\tif ( !node ) return\n\n\t\tconst View = this.root()\n\t\tconst obj = new View\n\n\t\tnode.replaceWith( obj.dom_tree() )\n\t\tsetInterval( ()=> obj.dom_tree() , 100 )\n\t}\n\n\t// Тут и ниже, такие поля используются для кеширования.\n\t// Удалятся при добавлении реактивности, в следующей главе\n\t_dom_node = null as unknown as Element\n\t// Создание DOM-ноды и регистрация событий на ней\n\tdom_node() {\n\t\tif ( this._dom_node ) return this._dom_node\n\n\t\tconst node = $my_lom_dom_context.document.createElement( this.dom_name() )\n\n\t\tfor ( const [name, fn] of Object.entries(this.event()) ) {\n\t\t\tnode.addEventListener(name ,fn)\n\t\t}\n\n\t\t// Атрибут с именем класса, для матчинга из css\n\t\tnode.setAttribute('view', this.constructor.name)\n\n\t\treturn this._dom_node = node\n\t}\n\n\t// Актуализация атрибутов и полей\n\tdom_node_actual() {\n\t\tconst node = this.dom_node()\n\n\t\tfor ( const [name, val] of Object.entries(this.attr()) ) {\n\t\t\tnode.setAttribute(name, String(val))\n\t\t}\n\n\t\tfor ( const [name, val] of Object.entries(this.field()) ) {\n\t\t\t;(node as any)[name] = val\n\t\t}\n\n\t\treturn node\n\t}\n\n\t// Подготовка и рендеринг дочерних компонентов\n\tdom_tree() {\n\t\tconst node = this.dom_node_actual()\n\n\t\tconst node_list = this.sub().map( node => {\n\t\t\tif ( node === null ) return null\n\t\t\treturn node instanceof $my_lom_view ? node.dom_tree() : String(node)\n\t\t} )\n\n\t\t// Воспользуемся рендером из $mol\n\t\t$.$mol_dom_render_children( node , node_list )\n\n\t\treturn node\n\t}\n\n\t// Методы ниже будут переопредялятся в компонентах-наследниках\n\t\n\t// Имя DOM-элемента\n\tdom_name() {\n\t\treturn 'div'\n\t}\n\t// Объект с атрибутами\n\tattr(): { [key: string]: string|number|boolean|null } {\n\t\treturn {}\n\t}\n\t// Объект с событиями\n\tevent(): { [key: string]: (e: Event) => any } {\n\t\treturn {}\n\t}\n\t// Объекст с полями\n\tfield(): { [key: string]: any } {\n\t\treturn {}\n\t}\n\t// Дочерние компоненты\n\tsub(): Array<$my_lom_view | Node | string | number | boolean> {\n        return []\n    }\n\n}\n","Promise.resolve( ()=> $my_lom_view.mount() )\n","// mam/jk1mn/counter/button/button.ts\r\n\r\nclass $my_lom_button extends $my_lom_view {\r\n\tdom_name() { return 'button' }\r\n\r\n\ttitle() { return '' }\r\n\r\n\tclick( e: Event ) {}\r\n\r\n\tsub() {\r\n\t\treturn [ this.title() ]\r\n\t}\r\n\r\n\tevent() {\r\n\t\treturn {\r\n\t\t\tclick: (e: Event) => this.click(e)\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass $my_lom_button_minor extends $my_lom_button {\r\n\tattr() {\r\n\t\treturn {\r\n\t\t\t'jk1mn_counter_button_minor': true,\r\n\t\t}\r\n\t}\r\n}\r\n","// mam/jk1mn/counter/input/input.ts\r\n\r\nclass $my_lom_input extends $my_lom_view {\r\n\tdom_name() { return 'input' }\r\n\r\n\ttype() { return 'text' }\r\n\r\n\t_value = ''\r\n\tvalue( next = this._value ) {\r\n\t\treturn this._value = next\r\n\t}\r\n\r\n\tevent_change( e: Event ) {\r\n\t\tthis.value( (e.target as HTMLInputElement).value )\r\n\t}\r\n\r\n\tfield() {\r\n\t\treturn {\r\n\t\t\tvalue: this.value(),\r\n\t\t}\r\n\t}\r\n\r\n\tattr() {\r\n\t\treturn {\r\n\t\t\ttype: this.type(),\r\n\t\t}\r\n\t}\r\n\r\n\tevent() {\r\n\t\treturn {\r\n\t\t\tinput: (e: Event)=> this.event_change(e),\r\n\t\t}\r\n\t}\r\n}\r\n","// mam/my/counter/storage/storage.ts\r\n\r\nclass $my_lom_storage {\r\n\r\n\tstatic value<Value>( key: string, next?: Value ) {\r\n\t\tif ( next === undefined ) return JSON.parse( localStorage.getItem( key ) ?? 'null' )\r\n\r\n\t\tif ( next === null ) localStorage.removeItem( key )\r\n\t\telse localStorage.setItem( key, JSON.stringify( next ) )\r\n\r\n\t\treturn next\r\n\t}\r\n\r\n}\r\n","setInterval( ()=> {\t\n\t$my_lom_dom_context.document?.documentElement.setAttribute(\n\t\t'my_lom_theme' ,\n\t\tnew Date().getSeconds() < 30 ? 'light' : 'dark' ,\n\t)\n} , 1_000 )\n"]}